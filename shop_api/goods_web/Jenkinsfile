pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo "[build.sh]" && mkdir -p shop_api/goods_web && cd shop_api && cp $WORKSPACE/../shop_grpc/shop_api/go.mod $WORKSPACE/../shop_grpc/shop_api/go.sum . && cp -a $WORKSPACE/../shop_grpc/shop_api/goods_web/** goods_web/ && chmod +x goods_web/build.sh && /bin/bash goods_web/build.sh
            }
        }

    stage('Start') {
            steps {
                sshPublisher(publishers: [sshPublisherDesc(configName: '192.168.139.130', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'mkdir -p /data/goods_web/shop_api/tmp/log/goods_web/ && cd /data/goods_web/shop_api/ && chmod +x goods_web/start.sh && /bin/bash goods_web/start.sh', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: 'goods_web/', remoteDirectorySDF: false, removePrefix: '', sourceFiles: 'shop_api/goods_web/config-debug.yaml,shop_api/goods_web/config-pro.yaml,shop_api/goods_web_main,shop_api/goods_web/start.sh')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            }
        }

    }
}
